###########################
# HRE Decisions
###########################	

political_actions = {

	RUS_Start_The_Offensive_TRM = {
		icon = hol_draw_up_staff_plans
		allowed = {
			tag = TRM
		}
		available = {
			if = {
				limit = { russian_civil_war = no }
				OR = {
					GER = { has_war_with = RUS }
					GRU = { has_war_with = RUS }
					custom_trigger_tooltip = {
						tooltip = RUS_Start_The_Offensive_tooltip
						check_variable = { global.siberian_war_chance > 0.84 }
					}
				}
				OR = {
					has_completed_focus = TRM_Form_A_New_Cabinet
					has_completed_focus = TRM_Our_Proud_Varyag_2
					has_completed_focus = TRM_RSDRP_PSR
					has_completed_focus = TRM_KDV
					has_completed_focus = TRM_NDS
					has_completed_focus = TRM_New_Far_Eastern_Republic
					has_completed_focus = TRM_Transbaikal_Union
					has_completed_focus = TRM_Russian_Empire_In_Exile
					has_completed_focus = TRM_spirit_revolution
					has_completed_focus = TRM_Hail_Tsar
					has_completed_focus = TRM_ROVS_Secures_The_Power
					has_country_flag = SOV_restored_in_transamur
				}
			}
			OR = {
				is_owner_neighbor_of = FROM
				any_allied_country = { is_owner_neighbor_of = FROM }
			}
			NOT = { has_non_aggression_pact_with = FROM }
		}

		targets = { RUS RVA WRA RRF }
		target_root_trigger = {
			has_idea = TRM_dream
			NOT = { has_active_mission = TRM_will_declare_war_on_RUS }
		}
		target_trigger = {
			can_declare_war_on = FROM
			if = {
				limit = { russian_civil_war = no }
				FROM = { owns_state = 219 }
			}
		}

		cost = 10
		days_remove = 14
		fire_only_once = yes
		cancel_if_not_visible = yes
		war_with_target_on_remove = yes

		ai_will_do = {
			factor = 100
			modifier = {
				factor = 0
				RUS_dont_attack_if_vulnerable_or_preparing = yes
			}
			modifier = {
				factor = 0
				FROM = { RUS_dont_attack_if_target_is_stronger = yes }
			}
			modifier = {
				factor = 0
				FROM = { RUS_dont_attack_if_faction_is_stronger = yes }
			}
			modifier = {
				factor = 0
				FROM = { RUS_dont_attack_if_overlord_is_stronger = yes }
			}
			modifier = {
				factor = 0
				AND = {
					russian_civil_war = yes
					FROM = { tag = RUS }
					TRM_nra_game_rule = yes
				}
			}
		}
		cancel_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision cancelled RUS_Start_The_Offensive_TRM target: [From.GetName]"
			clr_country_flag = imminent_war
			FROM = {
				add_ai_strategy = {
					type = prepare_for_war
					id = ROOT
					value = -1000
				}
			}
			for_each_scope_loop = {
				array = FROM.faction_members
				if = {
					limit = { is_neighbor_of = ROOT }
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = -1000
					}
				}
			}
			add_political_power = 10
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision RUS_Start_The_Offensive_TRM target: [From.GetName]"
			set_country_flag = { flag = imminent_war days = 20 value = 1 }
			FROM = {
				add_ai_strategy = {
					type = prepare_for_war
					id = ROOT
					value = 1000
				}
			}
			for_each_scope_loop = {
				array = FROM.faction_members
				if = {
					limit = { is_neighbor_of = ROOT }
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = 1000
					}
				}
			}
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove RUS_Start_The_Offensive_TRM target: [From.GetName]"
			FROM = {
				add_ai_strategy = {
					type = prepare_for_war
					id = ROOT
					value = -1000
				}
			}
			for_each_scope_loop = {
				array = FROM.faction_members
				if = {
					limit = { is_neighbor_of = ROOT }
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = -1000
					}
				}
			}
			declare_war_on = {
				target = FROM
				type = annex_everything
			}
			if = {
				limit = {
					check_variable = { RUS_Speech_About_Peaceful_Unification_amount_var = 1 }
				}
				add_stability = -0.05
				add_political_power = -15
			}
			else_if = {
				limit = {
					check_variable = { RUS_Speech_About_Peaceful_Unification_amount_var = 2 }
				}
				add_stability = -0.1
				add_political_power = -30
			}
			else_if = {
				limit = {
					check_variable = { RUS_Speech_About_Peaceful_Unification_amount_var = 3 }
				}
				add_stability = -0.15
				add_political_power = -60
			}
			hidden_effect = {
				random_other_country = {
					limit = {
						NOT = { tag = TRM }
					}
					news_event = {
						id = russianews.7
						days = 1
					}
				}
			}
		}
	}
}

RUS_Foreign_Policy_decisions = {
	RUS_Attack_Germany = {
		icon = GFX_decision_category_gerrivals
		priority = 150

		available = {
			date > 1941.1.1
				if = {
				limit = {
					NOT = { has_global_flag = second_weltkrieg_has_started }
				}
				has_army_manpower = {
					size > 1750000
				}
			}
			any_neighbor_country = {
				OR = {
					is_ally_with = FROM
					tag = FROM
				}
			}
		}

		visible = {
			can_declare_war_on = FROM
			NOT = { has_global_flag = danzig_treaty_active }
		}

		targets = { GER GRU }
		target_root_trigger = {
			if = {
				limit = {
					NOT = { has_global_flag = second_weltkrieg_has_started }
				}
				OR = {
					has_completed_focus = RUS_The_Final_Battle
					has_completed_focus = RUS_Destroy_German_Imperialists
				}
			}
		}
		target_trigger = {
			can_declare_war_on = FROM
		}
		
		cost = 0
		days_remove = 40
		fire_only_once = yes
		war_with_target_on_remove = yes

		ai_will_do = {
			factor = 150
			modifier = {
				factor = 0
				RUS_dont_attack_if_vulnerable_or_preparing = yes
			}
			modifier = {
				factor = 0
				date < 1939.6.1
			}
			modifier = {
				factor = 0
				date < 1941.1.1
				OR = {
					has_war_with = TRK
					has_war_with = UZB
					has_war_with = KYR
				}
			}
			modifier = {
				factor = 0
				date < 1942.1.1
				GRU = {
					exists = yes						
					has_war = no
				}
			}
			modifier = {
				factor = 0
				UKR = {
					is_in_faction_with = GER
					RUS_dont_attack_if_target_is_stronger = yes
				}
			}
			modifier = {
				factor = 0
				POL = {
					is_in_faction_with = GER
					RUS_dont_attack_if_target_is_stronger = yes
				}
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision RUS_Attack_Germany target: [From.GetName]"
			set_country_flag = { flag = imminent_war days = 45 value = 1 }
			for_each_scope_loop = {
				array = FROM.faction_members
				if = {
					limit = {
						OR = {
							is_in_europe = yes
							tag = DKB
							tag = KUB
							tag = KLY
							tag = MTR
							tag = GEO
							tag = AZE
						}
						is_in_faction_with = GER
						ROOT = {
							can_declare_war_on = PREV
							is_neighbor_of = PREV
						}
						if = {
							limit = { tag = UKR }
							NOT = { has_global_flag = UKR_secret_collusion_with_russia }
						}
					}
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = 1000
					}
					ROOT = {
						set_country_flag = RUS_prepare_for_war_@PREV
						add_ai_strategy = {
							type = prepare_for_war
							id = PREV
							value = 1000
						}
					}
				}	
				else = {
					limit = {
						OR = {
							is_in_europe = yes
							tag = DKB
							tag = KUB
							tag = KLY
							tag = MTR
							tag = GEO
							tag = AZE
						}
						is_in_faction_with = GRU
						ROOT = {
							can_declare_war_on = PREV
							is_neighbor_of = PREV
						}
						if = {
							limit = { tag = VKR }
							NOT = { has_global_flag = UKR_secret_collusion_with_russia }
						}
					}
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = 1000
					}
					ROOT = {
						set_country_flag = RUS_prepare_for_war_@PREV
						add_ai_strategy = {
							type = prepare_for_war
							id = PREV
							value = 1000
						}
					}
				}
			}			
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove RUS_Attack_Germany target: [From.GetName]"
			news_event = worldnews.472
			clr_country_flag = RUS_GER_blocks_caucasus
			effect_tooltip = {
				every_other_country = {
				if = {
					limit = {
						OR = {
							is_in_europe = yes
							tag = DKB
							tag = GEO
							tag = AZE
						}
						is_in_faction_with = GER
						ROOT = {
							can_declare_war_on = PREV
							is_neighbor_of = PREV
						}
						if = {
							limit = { tag = UKR }
							NOT = { has_global_flag = UKR_secret_collusion_with_russia }
						}
					}
					ROOT = {
						declare_war_on = {
							target = PREV
							type = annex_everything
						}
					}
				}
				else = {
					limit = {
						OR = {
							is_in_europe = yes
							tag = DKB
							tag = GEO
							tag = AZE
						}
						is_in_faction_with = GRU
						ROOT = {
							can_declare_war_on = PREV
							is_neighbor_of = PREV
						}
						if = {
							limit = { tag = VKR }
							NOT = { has_global_flag = UKR_secret_collusion_with_russia }
						}
					}
					ROOT = {
						declare_war_on = {
							target = PREV
							type = annex_everything
							}
						}
					}
				} 
			}
			every_other_country = {
				limit = {
					ROOT = { has_country_flag = RUS_prepare_for_war_@PREV }
				}
				add_ai_strategy = {
					type = prepare_for_war
					id = ROOT
					value = -1000
				}
				ROOT = {
					clr_country_flag = RUS_prepare_for_war_@PREV
					add_ai_strategy = {
						type = prepare_for_war
						id = PREV
						value = -1000
					}
					declare_war_on = {
						target = PREV
						type = annex_everything
					}
				}
			}
		}
	}
}

RUS_MIO_decisions = {
	### Mine Pilled decision unlocked through Dalzavod MIO
	RUS_dalzavod_mining_baltic_sea = {
		icon = GFX_decision_generic_naval_mine
		allowed = { always = no }
		available = {
			owns_state = 195
			has_war = yes
		}
		visible = {
			mio:RUS_dalzavod_organisation = {
				is_mio_trait_completed = dalzavod_upgrade_3
			}
		}

		custom_cost_trigger = {
			command_power > 24
		}
		custom_cost_text = decision_cost_CP25

		days_remove = 60

		ai_will_do = { base = 5 }
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete RUS_dalzavod_mining_baltic_sea"
			hidden_effect = {
				add_command_power = -25
			}
			if = {
				limit = {
					NOT = {
						has_mines = {
							region = 9
							amount = 900
						}
					}
				}
				add_mines = {
					region = 9
					amount = RUS_dalzavod_mines_number
				}
			}
			else = {
				add_mines = {
					region = 248
					amount = RUS_dalzavod_mines_number
				}
			}
			if = {
				limit = { NOT = { has_variable = RUS_dalzavod_total_mines_launched } }
				set_variable = { RUS_dalzavod_total_mines_launched = 0 }
			}
			add_to_variable = { RUS_dalzavod_total_mines_launched = RUS_dalzavod_mines_number }
		}
	}
	RUS_dalzavod_mining_black_sea = {
		icon = GFX_decision_generic_naval_mine
		allowed = { always = no }
		available = {
			owns_state = 1263 #Rostov
			has_war = yes
		}
		visible = {
			mio:RUS_dalzavod_organisation = {
				is_mio_trait_completed = dalzavod_upgrade_1_3
			}
		}

		custom_cost_trigger = {
			command_power > 24
		}
		custom_cost_text = decision_cost_CP25

		days_remove = 60

		ai_will_do = { base = 5 }
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete RUS_dalzavod_mining_black_sea"
			hidden_effect = {
				add_command_power = -25
			}
			add_mines = {
				region = 30
				amount = RUS_dalzavod_mines_number
			}
			if = {
				limit = { NOT = { has_variable = RUS_dalzavod_total_mines_launched } }
				set_variable = { RUS_dalzavod_total_mines_launched = 0 }
			}
			add_to_variable = { RUS_dalzavod_total_mines_launched = RUS_dalzavod_mines_number }
		}
	}
	RUS_dalzavod_mining_far_east = {
		icon = GFX_decision_generic_naval_mine
		allowed = { always = no }
		available = {
			owns_state = 408 #Vladivostok
			has_war = yes
		}
		visible = {
			mio:RUS_dalzavod_organisation = {
				is_mio_trait_completed = dalzavod_upgrade_2_2
			}
		}

		custom_cost_trigger = {
			command_power > 24
		}
		custom_cost_text = decision_cost_CP25

		days_remove = 60

		ai_will_do = { base = 5 }
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete RUS_dalzavod_mining_far_east"
			hidden_effect = {
				add_command_power = -25
			}
			if = {
				limit = {
					NOT = {
						has_mines = {
							region = 79
							amount = 900
						}
					}
				}
				add_mines = {
					region = 79
					amount = RUS_dalzavod_mines_number
				}
			}
			else = {
				add_mines = {
					region = 87
					amount = RUS_dalzavod_mines_number
				}
			}
			if = {
				limit = { NOT = { has_variable = RUS_dalzavod_total_mines_launched } }
				set_variable = { RUS_dalzavod_total_mines_launched = 0 }
			}
			add_to_variable = { RUS_dalzavod_total_mines_launched = RUS_dalzavod_mines_number }
		}
	}
	RUS_dalzavod_mining_barents = {
		icon = GFX_decision_generic_naval_mine
		allowed = { always = no }
		available = {
			owns_state = 213 #Murmansk
			has_war = yes
		}
		visible = {
			mio:RUS_dalzavod_organisation = {
				is_mio_trait_completed = dalzavod_upgrade_3_3
			}
		}

		custom_cost_trigger = {
			command_power > 24
		}
		custom_cost_text = decision_cost_CP25

		days_remove = 60

		ai_will_do = { base = 5 }
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete RUS_dalzavod_mining_barents"
			hidden_effect = {
				add_command_power = -25
			}
			add_mines = {
				region = 46
				amount = RUS_dalzavod_mines_number
			}
			if = {
				limit = { NOT = { has_variable = RUS_dalzavod_total_mines_launched } }
				set_variable = { RUS_dalzavod_total_mines_launched = 0 }
			}
			add_to_variable = { RUS_dalzavod_total_mines_launched = RUS_dalzavod_mines_number }
		}
	}
	### TOZ Medal decision ###
	RUS_TOZ_Medals = {
		icon = GFX_decision_CHL_carabineros
		name = RUS_TOZ_Medals
		allowed = { always = no }
		available = { owns_state = 223 }
		visible = { RUS_has_one_TOZ_medal_trait = yes }

		custom_cost_trigger = {
			mio:RUS_toz_organisation = {
				check_variable = { funds > ROOT.TOZ_Required_Funds?500 }
			}
		}
		custom_cost_text = RUS_TOZ_Funds_Medals_Requirement

		days_remove = 10

		ai_will_do = { base = 5 }
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete RUS_TOZ_Medals"
			hidden_effect = {
				set_temp_variable = { funds_change = TOZ_Required_Funds?500 }
				multiply_temp_variable = { funds_change = -1 }
				mio:RUS_toz_organisation = { add_mio_funds = var:funds_change }
			}
			RUS_TOZ_Hand_Out_Medals = yes
		}
	}
	RUS_AV_Repeatable_Random_Funds = {
		icon = GFX_decision_generic_research
		name = RUS_AV_Repeatable_Random_Funds
		allowed = { always = no }

		custom_cost_trigger = {
			mio:RUS_av_organisation = {
				check_variable = { funds > 249 }
			}
		}
		custom_cost_text = RUS_AV_Funds_Requirement

		days_remove = 10

		ai_will_do = { base = 1000 }
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete RUS_AV_Repeatable_Random_Funds"
			mio:RUS_av_organisation = { RUS_AV_set_random_decaying_funds_bonus = yes }
			}
		}
}

